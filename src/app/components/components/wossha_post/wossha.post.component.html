<one-modal></one-modal>
<two-modal2></two-modal2>

<wossha-post-creator 
    [userSessionInfo]="userSessionInfo"
    [profileUsername]="username"
    [placeholder]="'Â¿ Algo para compartir ?'"
    (postCreatedEvent)="postCreatedListener($event)"
    (loadingEvent)="loadingEventListener($event)"
></wossha-post-creator>


<div class="text-center" style="margin-bottom: 15px;" *ngIf="loading">
    <i class="fas fa-circle-notch fa-spin wossha-spinner"></i>
</div>
<div class="card post-card" @items *ngFor="let post of posts">
    <div class="header">
        <a [routerLink]="['/pages/user', post.username]">
            <img class="avatar" style="width: 48px; height: 48px;" [src]="post.profilePicture | picturePipe" alt="...">
            <span style="color: #ffa534">@{{post.username}} - {{post.name}}</span>
        </a>       
    </div>
    <div class="content">
        <p>
            {{post.text}}
        </p>
        <div *ngIf="post.type=='IMAGE_POST'" class="col-md-12">
            <wossha-post-images [images]="post.attachments" [isComment]="false"></wossha-post-images>
        </div>
        <div class='clear'></div>
    </div>
    <div style="padding: 0 15px;">       
        <button href="#" class="btn btn-simple post-icon" style="padding-left: 0"><i class="fa fa-thumbs-up" [ngClass]="{'reacted': iReacted(post.reactions['LIKE'])}" (click)="react('LIKE', post.uuid, null)"></i></button>
        <a class="post-statistics" href="javascript:void(0)" (click)="openReactionsPopup(post.reactions, 'LIKE')">
            {{(post.reactions['LIKE']) ? post.reactions['LIKE'].length : 0}}
        </a>

        <button href="#" class="btn btn-simple post-icon"><i class="fa fa-thumbs-down" [ngClass]="{'reacted': iReacted(post.reactions['DISLIKE'])}" (click)="react('DISLIKE', post.uuid, null)"></i></button>
        <a class="post-statistics" href="javascript:void(0)" (click)="openReactionsPopup(post.reactions, 'DISLIKE')">
            {{(post.reactions['DISLIKE']) ? post.reactions['DISLIKE'].length : 0}}
        </a>
        
        <button href="#" class="btn btn-simple post-icon"><i class="fa fa-comment" (click)="showComments(post.uuid)"></i></button>
        <a class="post-statistics" href="javascript:void(0)" (click)="showComments(post.uuid)">
            {{post.comments.length}}
        </a>

        <button href="#" class="btn btn-simple post-icon"><i class="fa fa-share"></i></button>
    
        <span class="notif-time">{{post.created | fromDate}}</span>
    </div>
    <div *ngIf="post.showComments" class="comments-area">
        <div class="comments-container">
            <div class="post-card" @items *ngFor="let comment of post.comments">
                <div class="comment-header">
                    <a [routerLink]="['/pages/user', comment.username]">
                        <img class="avatar" style="width: 30px; height: 30px;" [src]="comment.profilePicture | picturePipe" alt="...">
                        <span style="color: #ffa534">@{{comment.username}} - {{comment.name}}</span>
                    </a>
                    &nbsp; 
                    <span>{{comment.text}}</span>
                    <div *ngIf="post.type=='IMAGE_POST'" class="col-md-12">
                        <wossha-post-images [images]="comment.attachments" [isComment]="true"></wossha-post-images>
                    </div>
                </div>
                <div style="padding: 0 15px;">       
                    <button href="#" class="btn btn-simple post-icon" style="padding-left: 0"><i class="fa fa-thumbs-up" [ngClass]="{'reacted': iReacted(comment.reactions['LIKE'])}" (click)="react('LIKE', post.uuid, comment.uuid)"></i></button>
                    <a class="post-statistics" href="javascript:void(0)" (click)="openReactionsPopup(comment.reactions, 'LIKE')">
                        {{(comment.reactions['LIKE']) ? comment.reactions['LIKE'].length : 0}}
                    </a>
            
                    <button href="#" class="btn btn-simple post-icon"><i class="fa fa-thumbs-down" [ngClass]="{'reacted': iReacted(comment.reactions['DISLIKE'])}" (click)="react('DISLIKE', post.uuid, comment.uuid)"></i></button>
                    <a class="post-statistics" href="javascript:void(0)" (click)="openReactionsPopup(comment.reactions, 'DISLIKE')">
                        {{(comment.reactions['DISLIKE']) ? comment.reactions['DISLIKE'].length : 0}}
                    </a>
                    <span class="notif-time">{{comment.created | fromDate}}</span>
                </div>
            </div>
        </div>
        <div class="text-center" style="margin-bottom: 15px;" *ngIf="post.loading">
            <i class="fas fa-circle-notch fa-spin wossha-spinner"></i>
        </div>
        <wossha-post-creator 
            [userSessionInfo]="userSessionInfo"
            [profileUsername]="username"
            [uuidPost]="post.uuid"
            [placeholder]="'Comenta algo'"
            (postCreatedEvent)="postCreatedListener($event)"
            (loadingEvent)="loadingEventListener($event)"
        ></wossha-post-creator>
    </div>
</div>

<div class="col-md-12" *ngIf="posts.length < totalItems">
    <button type="button" rel="tooltip" (click)="getPosts(true)" data-placement="left" class="btn btn-danger btn-block btn-icon ">
        <i class="fa fa-arrow-down"></i> Cargar mas...
    </button>
</div>